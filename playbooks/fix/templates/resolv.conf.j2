# /etc/resolv.conf - Generated by Ansible
# This file prevents DNS resolution loops between systemd-resolved and Consul DNS
#
# Changes made:
# - Uses external DNS servers directly instead of systemd-resolved stub (127.0.0.53)
# - Consul DNS still available at 127.0.0.1:8600 for .consul domains
# - Prevents "server misbehaving" errors from DNS loops

{% for dns_server in external_dns_servers %}
nameserver {{ dns_server }}
{% endfor %}

# Search domains
search {{ ansible_domain | default('local') }}

# Resolver options
options timeout:2
options attempts:3
options rotate
options single-request-reopen

# Note: For .consul domain queries, applications should query 127.0.0.1:8600 directly
# This configuration resolves the DNS loop issue while maintaining Consul DNS functionality
