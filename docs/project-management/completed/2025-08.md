# August 2025 - Completed Tasks

## Domain Migration Sprint (Aug 19-20)

### Sprint 1: Foundation & Critical Path (Completed Aug 19)

#### PR #71: Foundation - Variable Setup

- **Status**: ✅ Completed (merged 5ecac8d)
- **Description**: Added homelab_domain variable to group_vars
- **Implementation**:
  - Created `inventory/doggos-homelab/group_vars/all/main.yml`
  - Created `inventory/og-homelab/group_vars/all/main.yml`
  - Added `homelab_domain: "spaceships.work"` to both files
  - Variable accessible from all playbooks

#### PR #72: Nomad Jobs with HCL2 Variables

- **Status**: ✅ Completed (merged 260486a)
- **Description**: Added HCL2 variable support for domain migration
- **Implementation**:
  - Updated Nomad jobs to use HCL2 variables instead of Jinja2
  - Added variable declarations at top of HCL files
  - Configured proper variable defaults
  - Fixed deployment playbook to handle HCL2 variables

### Sprint 2: NetBox DNS Infrastructure (Completed Aug 19)

#### PR #76: NetBox DNS Zone Migration

- **Status**: ✅ Completed (merged 9567b22)
- **Description**: Migrated NetBox DNS playbooks to use domain variables
- **Implementation**:
  - Replaced all hardcoded .local references with {{ homelab_domain }}
  - Updated zone setup, record population, and testing playbooks
  - Fixed Jinja concatenation operators (+ to ~)
  - Made PowerDNS IP configurable
  - Created backup of original configurations in playbooks/.archive/
  - Updated CodeRabbit configuration to exclude archived files

### Dependency Updates (Completed)

#### PR #73: Update markdownlint-cli2

- **Status**: ✅ Completed (merged 5cabdf2)
- **Description**: Updated dependency markdownlint-cli2 to v0.18.1
- **Type**: Routine dependency update via Renovate

#### PR #74: Update Python

- **Status**: ✅ Completed (merged 4ed8be4)
- **Description**: Updated dependency python to v3.13.7
- **Type**: Routine dependency update via Renovate

## Summary

### Domain Migration Progress

- **Sprint 1 (Foundation)**: ✅ Complete
  - PR #71: homelab_domain variable setup
  - PR #72: Nomad HCL2 variables

- **Sprint 2 (NetBox DNS)**: ✅ Complete
  - PR #76: NetBox DNS playbook migration

- **Remaining Sprints**:
  - Sprint 3: PowerDNS Integration (Day 3)
  - Sprint 4: Ansible & Service Updates (Day 4)
  - Sprint 5: Documentation & Prevention (Day 5)

### Key Achievements

- Successfully parameterized domain configuration
- Migrated from hardcoded .local to configurable domain
- Fixed critical Jinja/HCL compatibility issues
- NetBox DNS playbooks now fully domain-aware
- Created proper backup strategy for migration

### Technical Improvements

- Resolved HCL2 variable implementation (fixing PR #70 issues)
- Fixed Jinja concatenation operators throughout playbooks
- Made infrastructure components configurable (PowerDNS IP)
- Improved CodeRabbit configuration for better PR reviews

---

## Vault Production Deployment (Aug 23 - Phase 2 Complete)

### Vault Production Cluster Deployment

- **Status**: ✅ Phase 2 Complete
- **Description**: Migrated from dev mode to production Raft cluster
- **Implementation**:
  - Deployed 3-node Raft cluster (lloyd leader, holly/mable followers)
  - All nodes running standardized Vault v1.20.2
  - Persistent storage at `/opt/vault/data` on each node
  - Cluster ports: 8200 (API), 8201 (Cluster communication)
  - Cluster ID: `f96ca9f2-5c5a-791e-d08c-61653ba7e39c`

### Security and Configuration

- **Audit Logging**: ✅ Enabled file audit backend at `/var/log/vault/audit.log`
- **Secret Engines**: 
  - ✅ Database engine enabled at `database/` path (v1.20.2+builtin.vault)
  - ✅ KV v2 engine enabled at `secret/` path (v0.24.0+builtin)
- **Service Policies**:
  - ✅ Created `postgresql-service` policy for database access
  - ✅ Created `powerdns-service` policy for DNS secret management
- **Unseal Configuration**: 5 unseal keys generated, 3 required (3 of 5 threshold)

### Impact

This deployment unblocks:
- PostgreSQL deployment with dynamic credentials
- PowerDNS secret management
- Domain migration infrastructure changes
- All production service deployments requiring persistent secrets
