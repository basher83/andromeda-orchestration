# Netdata configuration for vault-pki-exporter Prometheus metrics
# Place this file in /etc/netdata/go.d/prometheus.conf or append to existing prometheus.conf
#
# The prometheus collector will automatically discover and scrape these endpoints

jobs:
  - name: vault_pki_exporter_local
    url: http://localhost:9333/metrics
    update_every: 60  # Collect metrics every 60 seconds
    timeout: 10

    # If using Consul service discovery
  - name: vault_pki_exporter_consul
    url: http://vault-pki-exporter.service.consul:9333/metrics
    update_every: 60
    timeout: 10

    # Per-node configuration (if not using localhost)
  - name: vault_pki_exporter_lloyd
    url: http://192.168.11.20:9333/metrics
    update_every: 60
    timeout: 10

  - name: vault_pki_exporter_holly
    url: http://192.168.11.21:9333/metrics
    update_every: 60
    timeout: 10

  - name: vault_pki_exporter_mable
    url: http://192.168.11.22:9333/metrics
    update_every: 60
    timeout: 10

# Alert configuration
# Add to /etc/netdata/health.d/vault-pki.conf
#
# alarm: vault_pki_certificate_expiring_soon
# on: prometheus_vault_pki_exporter.x509_cert_expiry
# calc: $x509_cert_expiry
# every: 1m
# warn: $this < 30*24*60*60  # 30 days in seconds
# crit: $this < 7*24*60*60   # 7 days in seconds
# info: Vault PKI certificate expiring in less than $this seconds
# to: sysadmin
